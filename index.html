<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
    <script src="js/strings.js"></script>
    <script type="text/javascript" src="js/global.js"></script>
    <script type="text/javascript" src="js/youtube_player.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.css">
    <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css" rel="stylesheet" type="text/css">  
    <link href="css/main.css" rel="stylesheet" type="text/css">

    <title>ReddiTube: Best of Youtube from Youtube</title>   
 
  </head>
  
  <body>
    <div class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" id="https://www.reddit.com/r/videos.json&after="><span><img class="" src="http://byterevel.com/wp-content/uploads/2014/07/alientube-logo.jpg" height="30" width="30">ReddiTube</span></a>
        </div>
        <div class="collapse navbar-collapse" id="navbar-ex-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li class="active">
              <a href="#" id="https://www.reddit.com/r/videos.json?after=">Hot</a>
            </li>
            <li>
              <a href="#" id="https://www.reddit.com/r/videos/rising.json?after=">Rising</a>
            </li>
            <li class="dropdown">
                <a href="https://www.reddit.com/r/videos/top.json?sort=top&t=all&after=" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Top<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=all&after=">all time</a></li>
                  <li><a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=hour&after=">past hour</a></li>
                  <li><a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=day&after=">past 24 hours</a></li>
                  <li><a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=week&after=">past week</a></li>
                  <li><a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=month&after=">past month</a></li>
                  <li><a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=year&after=">past year</a></li>
                </ul>
              </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="section">
      <div class="container">
        <div class="row" id="main">
          
        </div>
      </div>
    </div>
    <div class="section" id="nextPageIcon" style="display:none;">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <a href="javascript:void(0);" class="pull-right" id="next"><i class="fa fa-3x fa-fw fa-arrow-circle-down"></i></a>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
</script>
<script type="text/javascript" src="js/animation.js"></script>
<script type="text/javascript">
$('ul.nav li.dropdown').hover(function() {
  $(this).find('.dropdown-menu').stop(true, true).delay(100).fadeIn(250);
}, function() {
  $(this).find('.dropdown-menu').stop(true, true).delay(100).fadeOut(250);
});
function loadPage()
{
  getData()
}
function getData()
{
  $.get( REDDITUBE.reddit_url+REDDITUBE.after_code,processData)       
}
function processData(data)
{
  REDDITUBE.after_code= data['data']['after']
  $('#loading').remove()
  $('#nextPageIcon').css("display", "block");    
  youtube_videos = _.filter(data['data']['children'], function(video){ return video['data']['domain'] == 'youtube.com'; });
  data = _.map(youtube_videos, function(videos)
  { 
    video = {}
    video['title'] = videos['data']['title']
    video['score'] = videos['data']['score']
    video['title_short'] = videos['data']['title'].trunc(50)
    url = videos['data']['url']
    video['video_id']= url.split('v=')[1];
    var ampersandPosition = video['video_id'].indexOf('&');
    if(ampersandPosition != -1) {
      video['video_id'] = video['video_id'].substring(0, ampersandPosition);
    }
    video['video_url'] = "http://www.youtube.com/embed/"+video['video_id']+"?enablejsapi=1&wmode=opaque"
    video['thumbnail'] = "https://img.youtube.com/vi/{0}/0.jpg".format(video['video_id'])
    video['permalink'] = "https://reddit.com"+videos['data']['permalink']
    video['share_link'] = "http://redditube.tk/#v="+video['video_id']
    return video
  });
  addToPage("#main",data)
}
function addToPage(div,objects)
{
  _.each(objects, function(video) {
    var source   = $("#video_item").html();
    var template = Handlebars.compile(source);
    var html    = template(video);
    $(html).appendTo( div );
  });
}  
</script>
<script type="text/javascript" src="js/events.js"></script>
<script id="video_item" type="text/x-handlebars-template">
  <div class="col-md-4">
    <a href={{permalink}} target="_blank">{{title_short}}</a>
    <a class="fancybox fancybox.iframe" href="{{video_url}}" rel="videos" title="
      <a href='{{permalink}}' target='_blank'>
      {{title}}
      </a>
      ">
      <image width="360" height="270" src="{{thumbnail}}" class="img-responsive" id={{video_id}} title="Score: {{score}}"/>
    </a>
  </div>
</script>
</html>