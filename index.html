<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http://www.youtube.com/player_api"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.css">
    <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/main.css">    
  </head>  
  <body>
    <div class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" id="https://www.reddit.com/r/videos.json&after="><span>ReddiTube</span></a>
        </div>
        <div class="collapse navbar-collapse" id="navbar-ex-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li class="active">
              <a href="#" id="https://www.reddit.com/r/videos.json?after=">Hot</a>
            </li>
            <li>
              <a href="#" id="https://www.reddit.com/r/videos/rising.json?after=">Rising</a>
            </li>
            <li>
              <a href="#" id="https://www.reddit.com/r/videos/top.json?sort=top&t=all&after=">Top</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="section">
      <div class="container">
        <div class="row" id="main">
        	
        </div>
      </div>
    </div>
    <div class="section" id="nextPageIcon" style="display:none;">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <a href="javascript:void(0);" class="pull-right" id="next"><i class="fa fa-3x fa-fw fa-arrow-circle-down"></i></a>
          </div>
        </div>
      </div>
    </div>
  </body>
<script type="text/javascript" src="js/global.js"></script>
<script type="text/javascript" src="js/strings.js"></script>
<script type="text/javascript" src="js/events.js"></script>
<script type="text/javascript" src="js/youtube_player.js"></script>
<script type="text/javascript">
  

function dotAnimation()
{
  $('#main').html('<div id="loading"><h2>Loading</h2></div>')
  //this feels stupid
  var originalText = $("h2").text(),
  i  = 0;
  setInterval(function() 
  {

      $("h2").append(".");
      i++;
      
      if(i == 4)
      {
          $("h2").html(originalText);
          i = 0;
      }

  }, 500);
}
function loadPage()
{
  $.get( REDDITUBE.reddit_url+REDDITUBE.after_code, function( data ) {
        REDDITUBE.after_code= data['data']['after']
        youtube_videos = _.filter(data['data']['children'], function(video){ return video['data']['domain'] == 'youtube.com'; });
        _.each(youtube_videos, function(video) {
          $('#loading').remove()
          $('#nextPageIcon').css("display", "block");
          title = video['data']['title']
          score = video['data']['score']
          title_trunc = video['data']['title'].trunc(50)
          url = video['data']['url']
          id = url.split('v=')[1];
          var ampersandPosition = id.indexOf('&');
          if(ampersandPosition != -1) {
            id = id.substring(0, ampersandPosition);
          }
          youtube_url = "http://www.youtube.com/embed/"+id+"?enablejsapi=1&wmode=opaque"
          thumbnail = "https://img.youtube.com/vi/{0}/0.jpg".format(id)
          permalink = "https://reddit.com"+video['data']['permalink']
          url = url.replace("watch?v=","/embed/");
          $( '<div class="col-md-4">\
                  <a href={4} target="_blank" <h5 name="{3}">{0}</h5></a>\
                  <a class="fancybox fancybox.iframe" href="{6}" rel="videos"><image width="360" height="270" src="{1}" class="img-responsive" id={2} title="{5}"></a>\
                </div>'.format(title_trunc,thumbnail,id,title,permalink,"Score: "+score,youtube_url)
              ).appendTo( "#main" );

        }); 
    });
} 
</script>
</html>
